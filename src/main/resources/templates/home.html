<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout">
<head>
    <title>Error Repository | Home</title>
</head>

<body>
<main layout:fragment="content">
    <section class="row text-center">
        <div class="col-12" id="pieChart"></div>
    </section>

    <h3>Recent 10 Errors</h3>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>ID</th>
                <th>Error Message</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="info : ${recentInfos}">
                <td th:text="${info.infoId}"></td>
                <td th:text="${info.message}"></td>
                <td><a href="/detail" th:href="@{'/detail/' + ${info.infoId}}">detail</a></td>
            </tr>
            </tbody>
        </table>
    </div>
    <script src="/js/d3.min.js" th:src="@{/js/d3.min.js}"></script>
    <script src="/js/d3pie.min.js" th:src="@{/js/d3pie.min.js}"></script>
    <script th:inline="javascript">
        var content = [];
        var color = ["red", "blue", "green"];
    </script>
    <script th:each="categoryCount, stat:${categoryCounts}" th:inline="javascript">
        var index = [[${stat.index}]];
        content.push({
            "label": [[${categoryCount.category}]],
            "value": [[${categoryCount.count}]],
            "color": color[index % color.length]
        });
    </script>
    <script th:inline="javascript">
        var pie = new d3pie("pieChart", {
            "header": {
                "title": {
                    "text": "Error Category",
                    "fontSize": 30,
                    "font": "courier"
                },
                "subtitle": {
                    "text": "How many errors of each category is occurring?",
                    "color": "#999999",
                    "fontSize": 9,
                    "font": "courier"
                },
                "location": "pie-center",
                "titleSubtitlePadding": 10
            },
//        "footer": {
//            "text": "* This was curious. We're not sure why several people regard Winnipeg as a Top 15 Fear.",
//            "color": "#999999",
//            "fontSize": 10,
//            "font": "open sans",
//            "location": "bottom-left"
//        },
            "size": {
                "canvasWidth": 590,
                "pieInnerRadius": "90%",
                "pieOuterRadius": "70%"
            },
            "data": {
                "sortOrder": "none",
                "content": content
            },
            "labels": {
                "outer": {
                    "format": "label-value1",
                    "pieDistance": 20
                },
                "inner": {
                    "format": "none"
                },
                "mainLabel": {
                    "fontSize": 11
                },
                "percentage": {
                    "color": "#999999",
                    "fontSize": 11,
                    "decimalPlaces": 0
                },
                "value": {
                    "color": "#999999",
                    "fontSize": 11
                },
                "lines": {
                    "enabled": true,
                    "color": "#777777"
                },
                "truncation": {
                    "enabled": true
                }
            },
            "effects": {
                "pullOutSegmentOnClick": {
                    "effect": "linear",
                    "speed": 400,
                    "size": 8
                }
            },
            "misc": {
                "colors": {
                    "segmentStroke": "#000000"
                }
            }
        });
    </script>
</main>

</body>
</html>